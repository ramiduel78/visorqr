<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escáner QR</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f9;
        }
        video {
            width: 100%;
            max-width: 400px;
            border: 2px solid #ccc;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div>
        <h2>Escanear QR</h2>
        <video id="qr-video" autoplay playsinline></video>
        <p id="qr-result"></p>
    </div>

    <script>
        const qrVideo = document.getElementById('qr-video');
        const qrResult = document.getElementById('qr-result');

        function startQRScanner() {
            const constraints = { video: { facingMode: "environment" } };
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    qrVideo.srcObject = stream;
                    qrVideo.play();
                    requestAnimationFrame(tick);
                })
                .catch(err => {
                    console.error("Error al acceder a la cámara:", err);
                    alert("No se pudo acceder a la cámara. Asegúrate de otorgar permisos y usar HTTPS.");
                });
        }

        function tick() {
            if (qrVideo.readyState === qrVideo.HAVE_ENOUGH_DATA) {
                const canvas = document.createElement('canvas');
                canvas.width = qrVideo.videoWidth;
                canvas.height = qrVideo.videoHeight;

                const context = canvas.getContext('2d');
                context.drawImage(qrVideo, 0, 0, canvas.width, canvas.height);
                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);

                try {
                    const code = jsQR(imageData.data, imageData.width, imageData.height);
                    if (code) {
                        console.log("QR detectado:", code.data);
                        qrResult.textContent = `Contenido del QR: ${code.data}`;
                        stopQRScanner();
                    }
                } catch (err) {
                    console.error("Error al decodificar el QR:", err);
                }
            }
            requestAnimationFrame(tick);
        }

        function stopQRScanner() {
            const stream = qrVideo.srcObject;
            if (stream) {
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                qrVideo.srcObject = null;
            }
        }

        // Iniciar el escáner cuando la página cargue
        startQRScanner();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/jsQR/dist/jsQR.js"></script>
</body>
</html>
